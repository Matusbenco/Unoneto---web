<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Profit Calc Pro 2026 | Unoneto</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: white; -webkit-tap-highlight-color: transparent; }
        
        .glass-panel {
            background: rgba(30, 41, 59, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }

        .section-title {
            font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.05em; 
            color: #94a3b8; font-weight: 700; margin-bottom: 8px; display: block;
        }

        .custom-input {
            width: 100%; background: #1e293b; border: 1px solid #475569;
            color: white; padding: 12px; border-radius: 10px;
            font-size: 1rem; font-weight: 500; transition: 0.2s;
        }
        .custom-input:focus { outline: none; border-color: #6366f1; background: #0f172a; }

        .currency-select {
            position: absolute; right: 2px; top: 2px; bottom: 2px;
            background: #334155; border: none; color: white;
            border-radius: 8px; padding: 0 8px; font-weight: 600; font-size: 0.8rem;
            cursor: pointer; outline: none; text-align: center; min-width: 60px;
        }

        .vat-toggle {
            display: flex; background: #334155; border-radius: 8px; padding: 2px;
            margin-bottom: 8px; width: fit-content;
        }
        .vat-opt {
            padding: 4px 12px; font-size: 0.75rem; border-radius: 6px; cursor: pointer; transition: 0.2s; color: #94a3b8;
        }
        .vat-opt.active { background: #6366f1; color: white; font-weight: 600; }

        .country-btn {
            padding: 6px 10px; border-radius: 8px; font-size: 0.8rem; font-weight: 600;
            border: 1px solid #475569; background: rgba(255,255,255,0.05); color: #cbd5e1;
            cursor: pointer; transition: 0.2s; flex-shrink: 0;
        }
        .country-btn.active {
            background: #6366f1; border-color: #6366f1; color: white;
        }

        .result-card {
            background: rgba(15, 23, 42, 0.6); border-radius: 12px; padding: 12px;
            border: 1px solid rgba(255,255,255,0.05); text-align: center;
        }
        .result-val { font-size: 1.3rem; font-weight: 700; color: white; }
        .result-lbl { font-size: 0.7rem; color: #94a3b8; text-transform: uppercase; }

        input[type=range] {
            -webkit-appearance: none; width: 100%; height: 6px; background: #334155;
            border-radius: 3px; outline: none; margin-top: 10px;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 18px; height: 18px;
            border-radius: 50%; background: #6366f1; cursor: pointer; border: 2px solid #fff;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4 bg-slate-900">

    <div class="w-full max-w-lg flex items-center justify-between mb-5 pt-2">
        <a href="index.html" class="flex items-center gap-2 text-slate-400 hover:text-white px-2 py-1 rounded-lg">
            <span>‚Üê</span> Sp√§≈•
        </a>
        <h1 class="font-bold text-lg text-white flex items-center gap-2">
            <i class="fa-solid fa-calculator text-indigo-400"></i> Profit Calc 2026
        </h1>
    </div>

    <div class="w-full max-w-lg glass-panel p-5 space-y-6">

        <div>
            <div class="flex justify-between items-center mb-2">
                <span class="section-title mb-0">Nastavenie DPH</span>
                <span class="text-xs font-mono text-indigo-300 bg-indigo-500/20 px-2 rounded" id="vat-display">23%</span>
            </div>
            <div class="flex gap-2 overflow-x-auto no-scrollbar pb-1">
                <button class="country-btn active" onclick="setVat(23, this)">üá∏üá∞ SK</button>
                <button class="country-btn" onclick="setVat(21, this)">üá®üáø CZ</button>
                <button class="country-btn" onclick="setVat(27, this)">üá≠üá∫ HU</button>
                <button class="country-btn" onclick="setVat(23, this)">üáµüá± PL</button>
                <button class="country-btn" onclick="customVat(this)">‚úèÔ∏è In√©</button>
            </div>
        </div>

        <div class="bg-slate-800/40 p-4 rounded-xl border border-slate-700 relative">
            <span class="section-title">N√°kupn√° cena (Import)</span>
            
            <div class="relative mb-3">
                <input type="number" id="cost-input" class="custom-input text-blue-300 pr-24" placeholder="0.00" oninput="calc('cost')">
                <select id="cost-currency" class="currency-select" onchange="updateRates()">
                    <option value="EUR">EUR ‚Ç¨</option>
                    <option value="USD">USD $</option>
                    <option value="CZK">CZK Kƒç</option>
                    <option value="PLN">PLN z≈Ç</option>
                    <option value="HUF">HUF Ft</option>
                    <option value="GBP">GBP ¬£</option>
                </select>
            </div>

            <div id="cost-fx-row" class="hidden flex justify-between items-center text-xs bg-slate-900/50 p-2 rounded-lg border border-slate-700 mb-2">
                <span class="text-slate-400">Kurz (1‚Ç¨ =):</span>
                <div class="flex items-center gap-2">
                    <input type="number" id="cost-fx-rate" class="bg-transparent text-right w-20 text-white font-mono focus:outline-none border-b border-slate-600 focus:border-indigo-500" value="1.00" oninput="calc('cost')">
                    <span id="cost-fx-symbol" class="text-slate-500 text-[10px]"></span>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-5 gap-4">
            <div class="col-span-2">
                <span class="section-title">Mar≈æa %</span>
                <div class="relative">
                    <input type="number" id="margin" class="custom-input text-green-300 text-center" value="30" oninput="calc('margin')">
                    <input type="range" id="margin-slider" min="0" max="90" value="30" step="0.5" oninput="syncMargin(this.value)">
                </div>
            </div>

            <div class="col-span-3">
                <div class="flex justify-between items-end mb-1">
                    <span class="section-title mb-0">Predajn√° cena</span>
                    <div class="vat-toggle">
                        <div class="vat-opt active" id="mode-inc" onclick="setPriceMode('inc')">S DPH</div>
                        <div class="vat-opt" id="mode-exc" onclick="setPriceMode('exc')">BEZ</div>
                    </div>
                </div>
                <div class="relative">
                    <input type="number" id="sell-price" class="custom-input text-xl font-bold text-white pr-24" placeholder="0.00" oninput="calc('price')">
                    <select id="sell-currency" class="currency-select" onchange="updateRates()">
                        <option value="EUR">EUR ‚Ç¨</option>
                        <option value="USD">USD $</option>
                        <option value="CZK">CZK Kƒç</option>
                        <option value="PLN">PLN z≈Ç</option>
                        <option value="HUF">HUF Ft</option>
                        <option value="GBP">GBP ¬£</option>
                    </select>
                </div>
                
                <div id="sell-fx-row" class="hidden flex justify-between items-center text-xs bg-slate-900/50 p-2 rounded-lg border border-slate-700 mt-2">
                    <span class="text-slate-400">Kurz (1‚Ç¨ =):</span>
                    <div class="flex items-center gap-2">
                        <input type="number" id="sell-fx-rate" class="bg-transparent text-right w-20 text-white font-mono focus:outline-none border-b border-slate-600 focus:border-indigo-500" value="1.00" oninput="calc('sell')">
                        <span id="sell-fx-symbol" class="text-slate-500 text-[10px]"></span>
                    </div>
                </div>

                <div class="text-right mt-1">
                    <span class="text-[10px] text-slate-500 uppercase" id="alt-price-lbl">Bez DPH (EUR):</span>
                    <span class="text-xs font-mono text-slate-300" id="alt-price-val">0.00 ‚Ç¨</span>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-3">
            <div class="result-card">
                <div class="result-lbl">Zisk / ks</div>
                <div class="result-val text-green-400" id="profit-unit">0.00 ‚Ç¨</div>
            </div>
            <div class="result-card">
                <div class="result-lbl">Prir√°≈æka (Markup)</div>
                <div class="result-val text-blue-400" id="markup-val">0%</div>
            </div>
        </div>

        <div class="border-t border-slate-700 pt-4">
            <div class="flex items-center gap-2 mb-3 cursor-pointer text-slate-400 hover:text-white transition" onclick="document.getElementById('bulk-area').classList.toggle('hidden')">
                <i class="fa-solid fa-boxes-stacked"></i>
                <span class="font-bold text-sm">Mno≈æstevn√© zƒæavy</span>
                <i class="fa-solid fa-chevron-down text-xs ml-auto"></i>
            </div>
            
            <div id="bulk-area" class="hidden space-y-3 animation-fade-in">
                <div class="grid grid-cols-3 gap-3">
                    <div>
                        <span class="section-title">Poƒçet (ks)</span>
                        <input type="number" id="qty" class="custom-input text-center p-2" value="1" oninput="calc('bulk')">
                    </div>
                    <div class="col-span-2">
                        <span class="section-title">Zƒæava pre klienta %</span>
                        <input type="number" id="discount" class="custom-input text-red-300 text-center p-2" value="0" placeholder="0" oninput="calc('bulk')">
                    </div>
                </div>

                <div class="bg-slate-900/80 p-3 rounded-lg border border-slate-700 text-sm">
                    <div class="flex justify-between mb-1">
                        <span class="text-slate-400">Cena/ks (S DPH):</span>
                        <span class="font-bold text-white" id="discounted-price">0.00</span>
                    </div>
                    <div class="flex justify-between mb-1">
                        <span class="text-slate-400">Mar≈æa po zƒæave:</span>
                        <span class="font-bold text-yellow-400" id="discounted-margin">0%</span>
                    </div>
                    <div class="h-px bg-slate-700 my-2"></div>
                    <div class="flex justify-between items-center">
                        <span class="text-slate-200 font-bold">Celkov√Ω ƒçist√Ω zisk:</span>
                        <span class="text-xl font-bold text-green-400" id="total-profit">0.00 ‚Ç¨</span>
                    </div>
                </div>
            </div>
        </div>

    </div>

<script>
    // --- STAV APLIK√ÅCIE ---
    let state = {
        vat: 23,          // Default 2026 SK VAT
        costCurr: 'EUR',
        sellCurr: 'EUR',
        priceMode: 'inc', // 'inc' = s DPH, 'exc' = bez DPH
        rates: { EUR: 1 } // Cache pre kurzy (voƒçi EUR)
    };

    // --- FETCH RATES ---
    async function updateRates() {
        state.costCurr = document.getElementById('cost-currency').value;
        state.sellCurr = document.getElementById('sell-currency').value;

        // UI: Zobrazi≈• FX inputy ak to nie je EUR
        toggleFxRow('cost', state.costCurr);
        toggleFxRow('sell', state.sellCurr);

        // Fetch pre Cost
        if(state.costCurr !== 'EUR' && !state.rates[state.costCurr]) await fetchRate(state.costCurr);
        if(state.costCurr !== 'EUR') document.getElementById('cost-fx-rate').value = state.rates[state.costCurr] || 1;

        // Fetch pre Sell
        if(state.sellCurr !== 'EUR' && !state.rates[state.sellCurr]) await fetchRate(state.sellCurr);
        if(state.sellCurr !== 'EUR') document.getElementById('sell-fx-rate').value = state.rates[state.sellCurr] || 1;

        calc('recalc');
    }

    function toggleFxRow(type, curr) {
        const row = document.getElementById(`${type}-fx-row`);
        const sym = document.getElementById(`${type}-fx-symbol`);
        if (curr === 'EUR') {
            row.classList.add('hidden');
        } else {
            row.classList.remove('hidden');
            sym.innerText = curr;
        }
    }

    async function fetchRate(curr) {
        try {
            const res = await fetch(`https://api.frankfurter.app/latest?from=EUR&to=${curr}`);
            const data = await res.json();
            if (data.rates[curr]) {
                state.rates[curr] = data.rates[curr];
            }
        } catch (e) { console.error("Rate Error", e); }
    }

    // --- DPH NASTAVENIA ---
    function setVat(rate, btn) {
        state.vat = rate;
        document.getElementById('vat-display').innerText = rate + "%";
        document.querySelectorAll('.country-btn').forEach(b => b.classList.remove('active'));
        if(btn) btn.classList.add('active');
        calc('recalc');
    }

    function customVat(btn) {
        let val = prompt("Sadzba DPH (%):", "23");
        if(val) setVat(parseFloat(val), btn);
    }

    function setPriceMode(mode) {
        state.priceMode = mode;
        document.getElementById('mode-inc').className = `vat-opt ${mode==='inc'?'active':''}`;
        document.getElementById('mode-exc').className = `vat-opt ${mode==='exc'?'active':''}`;
        document.getElementById('alt-price-lbl').innerText = mode === 'inc' ? "Bez DPH:" : "S DPH:";
        calc('price');
    }

    function syncMargin(val) {
        document.getElementById('margin').value = val;
        calc('margin');
    }

    // --- HLAVN√ù V√ùPOƒåET ---
    function calc(source) {
        // 1. Inputs
        const costInput = parseFloat(document.getElementById('cost-input').value) || 0;
        const sellInput = parseFloat(document.getElementById('sell-price').value) || 0;
        let margin = parseFloat(document.getElementById('margin').value) || 0;

        // 2. Exchange Rates (Users can override)
        const costRate = (state.costCurr !== 'EUR') ? (parseFloat(document.getElementById('cost-fx-rate').value) || 1) : 1;
        const sellRate = (state.sellCurr !== 'EUR') ? (parseFloat(document.getElementById('sell-fx-rate').value) || 1) : 1;

        // 3. Convert Inputs to EUR Base (Normovanie)
        // Ak 1 EUR = 25 CZK, tak 100 CZK = 100 / 25 = 4 EUR
        const costEur = costInput / costRate;
        let sellEurNoVat = 0;

        // 4. Logic Branching
        if (source === 'cost' || source === 'margin' || source === 'recalc' || source === 'sell') {
            // Calculate Selling Price from Cost + Margin
            if (margin >= 100) margin = 99.9;
            
            if (costEur > 0) {
                // Margin Formula: Margin = (Price - Cost) / Price  => Price = Cost / (1 - Margin)
                sellEurNoVat = costEur / (1 - (margin / 100));
            } else {
                sellEurNoVat = 0;
            }

            // If source is 'price' (reverse calc), we handle it differently below
        }

        if (source === 'price') {
            // Calculate Margin from Selling Price
            let sellInputNoVat = sellInput;
            
            // Adjust input for VAT if needed
            if (state.priceMode === 'inc') {
                sellInputNoVat = sellInput / (1 + state.vat/100);
            }

            // Convert Sell Input Currency -> EUR
            sellEurNoVat = sellInputNoVat / sellRate;

            if (sellEurNoVat > 0) {
                margin = ((sellEurNoVat - costEur) / sellEurNoVat) * 100;
            } else {
                margin = 0;
            }
            
            document.getElementById('margin').value = margin.toFixed(1);
            document.getElementById('margin-slider').value = margin.toFixed(1);
        } else {
            // Update Selling Price Input (Convert EUR Base -> Sell Currency)
            let finalSell = sellEurNoVat; // Base EUR No VAT
            
            // Add VAT if needed
            if (state.priceMode === 'inc') {
                finalSell = finalSell * (1 + state.vat/100);
            }

            // Convert EUR -> Sell Currency
            finalSell = finalSell * sellRate;

            if (source !== 'bulk') { // Don't overwrite input if editing bulk only
                document.getElementById('sell-price').value = finalSell.toFixed(2);
            }
        }

        // 5. Update UI Stats (Always in EUR for base comparison or converted?)
        // Let's show stats in EUR for consistency, or Sell Currency? 
        // Best practice: Show Profit in EUR (Base).
        
        let altPriceEur = sellEurNoVat; // Base
        let altPriceDisplay = 0;
        
        // Helper text below sell price (always in Sell Currency)
        if (state.priceMode === 'inc') {
            // Show price without VAT
            altPriceDisplay = (sellEurNoVat * sellRate);
            document.getElementById('alt-price-lbl').innerText = `Bez DPH (${state.sellCurr}):`;
        } else {
            // Show price with VAT
            altPriceDisplay = (sellEurNoVat * (1 + state.vat/100) * sellRate);
            document.getElementById('alt-price-lbl').innerText = `S DPH (${state.sellCurr}):`;
        }
        document.getElementById('alt-price-val').innerText = altPriceDisplay.toFixed(2) + " " + state.sellCurr;

        // Profit & Markup
        let profitEur = sellEurNoVat - costEur;
        // Convert profit to Sell Currency for display? Or keep EUR? Let's keep EUR for clarity or Sell Curr?
        // User usually wants to know profit in the currency they are selling.
        let profitDisplay = profitEur * sellRate;
        
        const profitEl = document.getElementById('profit-unit');
        profitEl.innerText = profitDisplay.toFixed(2) + " " + state.sellCurr;
        profitEl.className = "result-val " + (profitDisplay >= 0 ? "text-green-400" : "text-red-400");

        let markup = 0;
        if (costEur > 0) markup = ((sellEurNoVat - costEur) / costEur) * 100;
        document.getElementById('markup-val').innerText = markup.toFixed(1) + "%";

        calcBulk(sellEurNoVat, costEur, sellRate);
    }

    function calcBulk(sellEurNoVat, costEur, sellRate) {
        let qty = parseFloat(document.getElementById('qty').value) || 1;
        let discount = parseFloat(document.getElementById('discount').value) || 0;

        // Base Calculations in EUR
        let priceWithVatEur = sellEurNoVat * (1 + state.vat/100);
        let discountedWithVatEur = priceWithVatEur * (1 - discount/100);
        let discountedNoVatEur = discountedWithVatEur / (1 + state.vat/100);

        // Convert to Display Currency (Sell Currency)
        let displayPrice = discountedWithVatEur * sellRate;
        
        // Margin Recalc
        let newMargin = 0;
        if (discountedNoVatEur > 0) {
            newMargin = ((discountedNoVatEur - costEur) / discountedNoVatEur) * 100;
        }

        // Total Profit (in Sell Currency)
        let totalProfitEur = (discountedNoVatEur - costEur) * qty;
        let totalProfitDisplay = totalProfitEur * sellRate;

        // UI Updates
        document.getElementById('discounted-price').innerText = displayPrice.toFixed(2) + " " + state.sellCurr;
        document.getElementById('total-profit').innerText = totalProfitDisplay.toFixed(2) + " " + state.sellCurr;
        
        const mEl = document.getElementById('discounted-margin');
        mEl.innerText = newMargin.toFixed(1) + "%";
        
        if(newMargin < 0) {
            mEl.className = "font-bold text-red-500";
            document.getElementById('total-profit').className = "text-xl font-bold text-red-500";
        } else if (newMargin < 10) {
            mEl.className = "font-bold text-orange-400"; 
            document.getElementById('total-profit').className = "text-xl font-bold text-green-400";
        } else {
            mEl.className = "font-bold text-yellow-400";
            document.getElementById('total-profit').className = "text-xl font-bold text-green-400";
        }
    }
</script>
</body>
</html>