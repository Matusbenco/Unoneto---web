<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SEO Inšpektor | Unoneto</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #f8fafc; margin: 0; }
        
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
        }

        .btn-gradient {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            transition: all 0.2s; cursor: pointer;
        }
        .btn-gradient:active { transform: scale(0.98); }

        /* PREVIEWS */
        .preview-box { background: white; border-radius: 8px; overflow: hidden; color: #333; font-family: Arial, sans-serif; }
        
        .g-wrap { padding: 15px; }
        .g-link { font-size: 12px; color: #202124; display: flex; align-items: center; gap: 5px; margin-bottom: 5px; }
        .g-title { font-size: 18px; color: #1a0dab; text-decoration: none; display: block; line-height: 1.3; margin-bottom: 3px; }
        .g-title:hover { text-decoration: underline; }
        .g-desc { font-size: 13px; color: #4d5156; line-height: 1.5; }

        .fb-wrap { background: #f0f2f5; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; max-width: 100%; }
        .fb-img-area { width: 100%; padding-bottom: 52%; position: relative; background: #ddd; }
        .fb-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        .fb-text-area { padding: 10px; background: #f0f2f5; border-top: 1px solid #ddd; }
        .fb-domain { font-size: 12px; text-transform: uppercase; color: #65676b; margin-bottom: 5px; }
        .fb-title { font-size: 16px; font-weight: bold; color: #050505; line-height: 1.2; margin-bottom: 3px; }
        .fb-desc { font-size: 13px; color: #65676b; line-height: 1.3; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

        /* SCORE */
        .score-circle {
            width: 80px; height: 80px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; font-weight: bold; color: white;
            background: conic-gradient(var(--score-color) var(--score-percent), #334155 0);
            position: relative; margin: 0 auto;
        }
        .score-circle::before {
            content: ''; position: absolute; width: 65px; height: 65px;
            background: #1e293b; border-radius: 50%;
        }
        .score-val { position: relative; z-index: 2; }

        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 8px; flex-shrink: 0; }
        .dot-green { background: #10b981; box-shadow: 0 0 5px #10b981; }
        .dot-red { background: #ef4444; box-shadow: 0 0 5px #ef4444; }
        .dot-orange { background: #f59e0b; box-shadow: 0 0 5px #f59e0b; }

        .manual-box { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
    </style>
</head>
<body class="min-h-screen flex flex-col text-sm">

    <header class="h-16 border-b border-slate-700 flex items-center justify-between px-4 lg:px-10 shrink-0 bg-slate-900/90 backdrop-blur z-50 fixed w-full top-0 z-50">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center text-white text-lg shadow-lg">
                <i class="fa-solid fa-magnifying-glass-chart"></i>
            </div>
            <h1 class="font-outfit font-bold text-lg text-white">SEO <span class="text-emerald-500">Inšpektor</span></h1>
        </div>
        <a href="index.html" class="text-slate-400 hover:text-white flex items-center gap-2 text-xs bg-slate-800 px-3 py-2 rounded-lg border border-slate-700">
            <i class="fa-solid fa-arrow-left"></i> Späť
        </a>
    </header>

    <main class="flex-1 w-full max-w-7xl mx-auto p-4 mt-16 flex flex-col gap-6">

        <div class="glass-panel p-6 text-center">
            <h2 class="text-xl font-bold text-white mb-2">SEO Audit Webu</h2>
            <p class="text-slate-400 mb-4 text-xs">Zadajte URL (napr. sme.sk) a počkajte na výsledok.</p>
            
            <div class="flex flex-col sm:flex-row gap-3">
                <input type="text" id="urlInput" placeholder="vasa-stranka.sk" class="flex-1 bg-slate-900 border border-slate-700 text-white rounded-xl px-4 py-3 focus:border-emerald-500 outline-none text-base">
                <button onclick="runAudit()" id="btnAnalyze" class="btn-gradient text-white font-bold px-6 py-3 rounded-xl flex items-center justify-center gap-2">
                    <i class="fa-solid fa-rocket"></i> Analyzovať
                </button>
            </div>
            
            <div id="loading" class="hidden mt-4 text-emerald-400 text-sm font-bold animate-pulse">
                <i class="fa-solid fa-circle-notch fa-spin mr-2"></i> Pripájam sa k webu...
            </div>

            <div id="manualInputArea" class="hidden manual-box mt-6 p-4 bg-slate-800/50 rounded-xl border border-slate-700 text-left">
                <div class="flex items-start gap-3">
                    <div class="text-orange-400 text-2xl"><i class="fa-solid fa-shield-cat"></i></div>
                    <div class="flex-1">
                        <h3 class="text-orange-400 font-bold mb-1">Web je chránený proti botom</h3>
                        <p class="text-slate-400 text-xs mb-3">Automatické stiahnutie zlyhalo (Firewall/Cloudflare). <br>Vložte zdrojový kód manuálne pre 100% výsledok:</p>
                        
                        <div class="bg-black/30 p-2 rounded text-[10px] text-slate-300 font-mono mb-3 border border-slate-600">
                            1. Otvorte váš web v novej karte.<br>
                            2. Stlačte <b>Ctrl + U</b> (Zobraziť zdrojový kód).<br>
                            3. Stlačte <b>Ctrl + A</b> (Označiť všetko) a <b>Ctrl + C</b> (Kopírovať).<br>
                            4. Vložte kód nižšie (Ctrl + V).
                        </div>

                        <textarea id="htmlInput" class="w-full h-32 bg-slate-900 border border-slate-600 rounded p-2 text-xs text-slate-300 font-mono focus:border-emerald-500 outline-none" placeholder="Sem vložte skopírovaný HTML kód..."></textarea>
                        
                        <button onclick="runManualAudit()" class="mt-3 bg-orange-600 hover:bg-orange-500 text-white px-4 py-2 rounded-lg font-bold text-xs flex items-center gap-2">
                            <i class="fa-solid fa-code"></i> Analyzovať Vložený Kód
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="resultsArea" class="hidden grid grid-cols-1 lg:grid-cols-12 gap-6 pb-10">
            
            <div class="lg:col-span-7 space-y-6">
                
                <div class="glass-panel p-5 border-l-4 border-emerald-500">
                    <div class="flex flex-col sm:flex-row items-center gap-6">
                        <div class="text-center">
                            <div class="score-circle" id="scoreCircle" style="--score-color: #10b981; --score-percent: 0%;">
                                <span class="score-val" id="scoreVal">0</span>
                            </div>
                            <div class="text-[10px] text-slate-400 font-bold mt-2 uppercase">Kvalita</div>
                        </div>
                        
                        <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 w-full">
                            <div class="bg-slate-800/50 p-2 rounded text-center">
                                <div class="text-lg font-bold text-blue-400" id="statWords">0</div>
                                <div class="text-[10px] text-slate-500 uppercase">Slov</div>
                            </div>
                            <div class="bg-slate-800/50 p-2 rounded text-center">
                                <div class="text-lg font-bold text-purple-400" id="statLinks">0</div>
                                <div class="text-[10px] text-slate-500 uppercase">Odkazov</div>
                            </div>
                            <div class="bg-slate-800/50 p-2 rounded text-center">
                                <div class="text-lg font-bold text-orange-400" id="statImgCount">0</div>
                                <div class="text-[10px] text-slate-500 uppercase">Obrázkov</div>
                            </div>
                            <div class="bg-slate-800/50 p-2 rounded text-center">
                                <div class="text-lg font-bold text-pink-400" id="statHtags">0</div>
                                <div class="text-[10px] text-slate-500 uppercase">H-Tagov</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass-panel p-5">
                    <h3 class="text-xs font-bold text-slate-400 uppercase mb-4 flex justify-between">
                        <span>Technický Audit</span>
                        <span class="text-emerald-500" id="auditPassCount">0/0 OK</span>
                    </h3>
                    <div class="space-y-3" id="auditList"></div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                    <div class="glass-panel p-5">
                        <h3 class="text-xs font-bold text-slate-400 uppercase mb-4">Kľúčové slová</h3>
                        <div class="flex flex-wrap gap-2" id="keywordList"></div>
                    </div>
                    <div class="glass-panel p-5">
                        <h3 class="text-xs font-bold text-slate-400 uppercase mb-4">Sociálne siete</h3>
                        <div id="socialList" class="flex flex-wrap gap-2"></div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-5 space-y-6">
                
                <div class="glass-panel p-5 bg-gradient-to-br from-slate-800 to-slate-900 border border-slate-700">
                    <h3 class="text-sm font-bold text-white mb-2"><i class="fa-solid fa-user-doctor text-emerald-400 mr-2"></i>Verdikt</h3>
                    <p class="text-slate-300 text-sm italic leading-relaxed" id="aiVerdict">...</p>
                </div>

                <div class="glass-panel p-4">
                    <h3 class="text-xs font-bold text-slate-400 uppercase mb-3"><i class="fa-brands fa-google text-blue-500"></i> Google Náhľad</h3>
                    <div class="preview-box g-wrap">
                        <div class="g-link">
                            <img id="gFavicon" src="" class="w-4 h-4 hidden">
                            <span id="gDomain" class="font-bold">domena.sk</span>
                        </div>
                        <a href="#" class="g-title" id="gTitle">Titulok stránky</a>
                        <div class="g-desc" id="gDesc">Popis stránky...</div>
                    </div>
                </div>

                <div class="glass-panel p-4">
                    <h3 class="text-xs font-bold text-slate-400 uppercase mb-3"><i class="fa-brands fa-facebook text-blue-600"></i> Facebook Náhľad</h3>
                    <div class="fb-wrap">
                        <div class="fb-img-area">
                            <img id="fbImg" class="fb-img hidden">
                            <div id="fbNoImg" class="absolute inset-0 flex items-center justify-center text-gray-400 text-xs">Bez obrázka</div>
                        </div>
                        <div class="fb-text-area">
                            <div class="fb-domain" id="fbDomain">DOMENA.SK</div>
                            <div class="fb-title" id="fbTitle">Titulok</div>
                            <div class="fb-desc" id="fbDesc">Popis...</div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </main>

<script>
    // --- MULTI-PROXY SYSTEM ---
    async function fetchHtml(url) {
        const encodedUrl = encodeURIComponent(url);
        
        const proxies = [
            { url: `https://api.allorigins.win/get?url=${encodedUrl}`, type: 'json' },
            { url: `https://corsproxy.io/?${encodedUrl}`, type: 'text' },
            { url: `https://api.codetabs.com/v1/proxy?quest=${encodedUrl}`, type: 'text' }
        ];

        for (const proxy of proxies) {
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 4000); // 4s timeout

                const res = await fetch(proxy.url, { signal: controller.signal });
                clearTimeout(timeoutId);

                if (!res.ok) throw new Error("HTTP Error");
                
                let text;
                if (proxy.type === 'json') {
                    const data = await res.json();
                    text = data.contents;
                } else {
                    text = await res.text();
                }

                if (!text || text.length < 50) throw new Error("Empty");
                return text;

            } catch (e) {
                console.warn(`Proxy failed: ${proxy.url}`);
            }
        }
        throw new Error("All proxies failed");
    }

    async function runAudit() {
        const input = document.getElementById('urlInput');
        const btn = document.getElementById('btnAnalyze');
        const loading = document.getElementById('loading');
        const manualArea = document.getElementById('manualInputArea');
        const results = document.getElementById('resultsArea');
        
        let url = input.value.trim();
        if (!url) return;

        url = url.replace(/\s/g, ''); 
        if (!/^https?:\/\//i.test(url)) url = 'https://' + url;

        // Reset
        manualArea.classList.add('hidden');
        results.classList.add('hidden');
        loading.classList.remove('hidden');
        btn.disabled = true;
        input.disabled = true;

        try {
            const htmlText = await fetchHtml(url);
            processHtml(htmlText, url);
        } catch (e) {
            loading.classList.add('hidden');
            manualArea.classList.remove('hidden'); // SHOW MANUAL INPUT
        } finally {
            btn.disabled = false;
            input.disabled = false;
        }
    }

    function runManualAudit() {
        const html = document.getElementById('htmlInput').value;
        const urlInput = document.getElementById('urlInput').value || "manual-input.sk";
        
        if(html.length < 20) {
            alert("Vložte prosím validný HTML kód.");
            return;
        }

        let url = urlInput.replace(/\s/g, '');
        if (!/^https?:\/\//i.test(url)) url = 'https://' + url;

        document.getElementById('manualInputArea').classList.add('hidden');
        document.getElementById('loading').classList.remove('hidden');

        setTimeout(() => {
            processHtml(html, url);
        }, 500);
    }

    function processHtml(htmlText, url) {
        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlText, "text/html");

        // Extraction
        const meta = {
            title: doc.querySelector('title')?.innerText.trim() || "",
            desc: doc.querySelector('meta[name="description"]')?.getAttribute('content')?.trim() || "",
            h1: Array.from(doc.querySelectorAll('h1')).map(h => h.innerText.trim()).filter(t => t.length > 0),
            h2s: doc.querySelectorAll('h2').length,
            h3s: doc.querySelectorAll('h3').length,
            ogTitle: doc.querySelector('meta[property="og:title"]')?.getAttribute('content') || "",
            ogDesc: doc.querySelector('meta[property="og:description"]')?.getAttribute('content') || "",
            ogImage: doc.querySelector('meta[property="og:image"]')?.getAttribute('content') || "",
            favicon: `https://www.google.com/s2/favicons?domain=${url}&sz=64`,
            domain: new URL(url).hostname,
            images: Array.from(doc.querySelectorAll('img')),
            links: Array.from(doc.querySelectorAll('a')),
            bodyText: doc.body.innerText
        };

        // Image Path Fix
        if (meta.ogImage && !meta.ogImage.startsWith('http')) {
            meta.ogImage = new URL(url).origin + (meta.ogImage.startsWith('/') ? '' : '/') + meta.ogImage;
        }

        renderResults(meta, url);
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('resultsArea').classList.remove('hidden');
        
        setTimeout(() => document.getElementById('resultsArea').scrollIntoView({ behavior: 'smooth', block: 'start' }), 100);
    }

    function renderResults(meta, url) {
        // Stats
        const words = meta.bodyText.split(/\s+/).filter(w => w.length > 0).length;
        document.getElementById('statWords').innerText = words;
        document.getElementById('statLinks').innerText = meta.links.length;
        document.getElementById('statImgCount').innerText = meta.images.length;

        // Previews
        document.getElementById('gTitle').innerText = truncate(meta.title, 60) || "Bez titulku";
        document.getElementById('gDesc').innerText = truncate(meta.desc, 155) || "Bez popisu...";
        document.getElementById('gDomain').innerText = meta.domain;
        document.getElementById('gFavicon').src = meta.favicon;
        document.getElementById('gFavicon').classList.remove('hidden');

        document.getElementById('fbTitle').innerText = truncate(meta.ogTitle || meta.title, 80);
        document.getElementById('fbDesc').innerText = truncate(meta.ogDesc || meta.desc, 100);
        document.getElementById('fbDomain').innerText = meta.domain.toUpperCase();
        
        const fbImg = document.getElementById('fbImg');
        const fbNoImg = document.getElementById('fbNoImg');
        if (meta.ogImage) {
            fbImg.src = meta.ogImage;
            fbImg.classList.remove('hidden');
            fbNoImg.classList.add('hidden');
        } else {
            fbImg.classList.add('hidden');
            fbNoImg.classList.remove('hidden');
        }

        analyzeKeywords(meta.bodyText);
        
        // Socials
        const socialContainer = document.getElementById('socialList');
        socialContainer.innerHTML = '';
        const networks = [
            { id: 'facebook.com', name: 'Facebook', cls: 'soc-fb', icon: 'fa-facebook' },
            { id: 'instagram.com', name: 'Instagram', cls: 'soc-ig', icon: 'fa-instagram' },
            { id: 'linkedin.com', name: 'LinkedIn', cls: 'soc-li', icon: 'fa-linkedin' },
            { id: 'youtube.com', name: 'YouTube', cls: 'soc-yt', icon: 'fa-youtube' }
        ];
        
        let foundSoc = false;
        meta.links.forEach(l => {
            networks.forEach(n => {
                if (l.href.includes(n.id) && !socialContainer.innerHTML.includes(n.name)) {
                    socialContainer.innerHTML += `<span class="social-tag ${n.cls}"><i class="fa-brands ${n.icon}"></i> ${n.name}</span>`;
                    foundSoc = true;
                }
            });
        });
        if (!foundSoc) socialContainer.innerHTML = '<span class="text-slate-500 text-xs italic">Žiadne prepojenia.</span>';

        runStrictAudit(meta, words);
    }

    function runStrictAudit(meta, wordCount) {
        const list = document.getElementById('auditList');
        const verdictEl = document.getElementById('aiVerdict');
        const scoreCircle = document.getElementById('scoreCircle');
        const scoreVal = document.getElementById('scoreVal');
        
        list.innerHTML = '';
        let score = 0;
        let totalWeight = 0;
        let passedChecks = 0;
        let totalChecks = 0;

        const check = (label, isPass, passMsg, failMsg, weight = 1, isWarning = false) => {
            totalWeight += weight;
            totalChecks++;
            if (isPass) { score += weight; passedChecks++; }

            let color = isPass ? 'dot-green' : (isWarning ? 'dot-orange' : 'dot-red');
            let textCol = isPass ? 'text-slate-300' : (isWarning ? 'text-orange-300' : 'text-red-300');

            list.innerHTML += `
                <div class="flex justify-between items-center border-b border-slate-700/50 pb-2">
                    <div class="flex items-center gap-2">
                        <span class="status-dot ${color}"></span>
                        <span class="text-white font-medium text-xs">${label}</span>
                    </div>
                    <span class="text-[10px] ${textCol} text-right max-w-[150px] leading-tight">${isPass ? passMsg : failMsg}</span>
                </div>
            `;
        };

        // KONTROLY (PRÍSNE)
        if (meta.title.length === 0) check("Titulok", false, "", "Chýba", 5);
        else if (meta.title.length < 15) check("Titulok", false, "", "Krátky (<15)", 3, true);
        else check("Titulok", true, "Optimálne ✅", "", 3);

        if (meta.desc.length === 0) check("Meta Popis", false, "", "Chýba", 5);
        else if (meta.desc.length < 70) check("Meta Popis", false, "", "Krátky", 3, true);
        else check("Meta Popis", true, "OK ✅", "", 3);

        if (meta.h1.length === 0) check("Nadpis H1", false, "", "Chýba", 5);
        else if (meta.h1.length > 1) check("Nadpis H1", false, "", "Duplicita", 3, true);
        else check("Nadpis H1", true, "OK ✅", "", 3);

        if (wordCount < 300) check("Obsah", false, "", "Málo textu", 4);
        else if (wordCount < 600) check("Obsah", false, "", "Priemer", 2, true);
        else check("Obsah", true, "Výborný ✅", "", 3);

        if (meta.images.length === 0) check("Obrázky", false, "", "Žiadne", 1, true);
        else {
            const missingAlt = meta.images.filter(i => !i.alt || i.alt.length < 2).length;
            if (missingAlt > 0) check("ALT", false, "", `${missingAlt}x chýba popis`, 3, true);
            else check("ALT", true, "Všetky OK ✅", "", 2);
        }

        check("Social", meta.ogImage.length > 5, "Nastavené ✅", "Chýba náhľad", 2);
        check("Linky", meta.links.length > 3, "OK ✅", "Málo", 1);

        const finalScore = Math.max(0, Math.round((score / totalWeight) * 100));
        
        let sColor = '#ef4444';
        if(finalScore > 50) sColor = '#f59e0b';
        if(finalScore > 85) sColor = '#10b981';

        animateValue(scoreVal, 0, finalScore, 1000);
        scoreCircle.style.setProperty('--score-color', sColor);
        scoreCircle.style.setProperty('--score-percent', `${finalScore}%`);
        document.getElementById('auditPassCount').innerText = `${passedChecks}/${totalChecks} OK`;

        let msg = "";
        if (finalScore > 90) msg = "Perfektné! Web spĺňa prísne SEO kritériá.";
        else if (finalScore > 70) msg = "Dobrý stav, ale s priestorom na zlepšenie.";
        else if (finalScore > 40) msg = "Priemerný web. Nutné doplniť meta dáta.";
        else msg = "Slabý výsledok. Web potrebuje zásadnú optimalizáciu.";
        verdictEl.innerText = msg;
    }

    function analyzeKeywords(text) {
        if (!text) return;
        const words = text.toLowerCase().replace(/[^\w\s\u00C0-\u017F]/g, '').split(/\s+/);
        const stopWords = ['a', 'v', 's', 'z', 'o', 'u', 'k', 'na', 'pre', 'pri', 'do', 'je', 'sa', 'si', 'to', 'že', 'ako', 'čo', 'len', 'ale', 'kde', 'kto', 'bol', 'bude', 'sme', 'sú', 'ten', 'tá', 'toho'];
        const counts = {};
        words.forEach(w => {
            if(w.length > 3 && !stopWords.includes(w) && isNaN(w)) counts[w] = (counts[w] || 0) + 1;
        });
        const sorted = Object.entries(counts).sort((a,b) => b[1] - a[1]).slice(0, 8);
        const container = document.getElementById('keywordList');
        container.innerHTML = '';
        if(sorted.length === 0) container.innerHTML = '<span class="text-slate-500 text-xs">Žiadne dáta</span>';
        sorted.forEach(([word, count]) => {
            container.innerHTML += `<span class="bg-white/10 px-2 py-1 rounded-full text-[10px] text-slate-300 border border-white/5">${word} <span class="opacity-50 ml-1">${count}x</span></span>`;
        });
    }

    function truncate(str, n) { return (str && str.length > n) ? str.substr(0, n-1) + '...' : str; }
    function animateValue(obj, start, end, duration) {
        let startTimestamp = null;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            obj.innerHTML = Math.floor(progress * (end - start) + start);
            if (progress < 1) window.requestAnimationFrame(step);
        };
        window.requestAnimationFrame(step);
    }
</script>

</body>
</html>

