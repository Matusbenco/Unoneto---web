<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SEO Inšpektor | Unoneto</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #f8fafc; margin: 0; }
        
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
        }

        .btn-gradient {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            transition: all 0.2s; cursor: pointer;
        }
        .btn-gradient:active { transform: scale(0.98); }

        /* PREVIEWS */
        .preview-box { background: white; border-radius: 8px; overflow: hidden; color: #333; font-family: Arial, sans-serif; }
        
        /* Google */
        .g-wrap { padding: 15px; }
        .g-link { font-size: 12px; color: #202124; display: flex; align-items: center; gap: 5px; margin-bottom: 5px; }
        .g-title { font-size: 18px; color: #1a0dab; text-decoration: none; display: block; line-height: 1.3; margin-bottom: 3px; }
        .g-desc { font-size: 13px; color: #4d5156; line-height: 1.5; }

        /* Facebook */
        .fb-wrap { background: #f0f2f5; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; max-width: 100%; }
        .fb-img-area { width: 100%; padding-bottom: 52%; position: relative; background: #ddd; }
        .fb-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        .fb-text-area { padding: 10px; background: #f0f2f5; border-top: 1px solid #ddd; }
        .fb-domain { font-size: 12px; text-transform: uppercase; color: #65676b; margin-bottom: 5px; }
        .fb-title { font-size: 16px; font-weight: bold; color: #050505; line-height: 1.2; margin-bottom: 3px; }
        .fb-desc { font-size: 13px; color: #65676b; line-height: 1.3; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

        /* SCORE */
        .score-circle {
            width: 80px; height: 80px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; font-weight: bold; color: white;
            background: conic-gradient(var(--score-color) var(--score-percent), #334155 0);
            position: relative; margin: 0 auto;
        }
        .score-circle::before {
            content: ''; position: absolute; width: 65px; height: 65px;
            background: #1e293b; border-radius: 50%;
        }
        .score-val { position: relative; z-index: 2; }

        /* SOCIAL TAGS */
        .social-tag { display: inline-flex; align-items: center; gap: 5px; padding: 5px 10px; border-radius: 6px; font-size: 0.8rem; font-weight: bold; margin: 2px; }
        .soc-fb { background: #1877F2; color: white; }
        .soc-ig { background: #E1306C; color: white; }
        .soc-li { background: #0077b5; color: white; }
        .soc-tt { background: #000000; color: white; border: 1px solid #333; }
        .soc-yt { background: #FF0000; color: white; }

        .status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 8px; flex-shrink: 0; }
        .dot-green { background: #10b981; box-shadow: 0 0 8px #10b981; }
        .dot-red { background: #ef4444; box-shadow: 0 0 8px #ef4444; }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
    </style>
</head>
<body class="min-h-screen flex flex-col text-sm">

    <header class="h-16 border-b border-slate-700 flex items-center justify-between px-4 lg:px-10 shrink-0 bg-slate-900/90 backdrop-blur z-50 fixed w-full top-0">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center text-white text-lg shadow-lg">
                <i class="fa-solid fa-magnifying-glass-chart"></i>
            </div>
            <h1 class="font-outfit font-bold text-lg text-white">SEO <span class="text-emerald-500">Inšpektor</span></h1>
        </div>
        <a href="index.html" class="text-slate-400 hover:text-white flex items-center gap-2 text-xs bg-slate-800 px-3 py-2 rounded-lg border border-slate-700">
            <i class="fa-solid fa-arrow-left"></i> Späť
        </a>
    </header>

    <main class="flex-1 w-full max-w-7xl mx-auto p-4 mt-16 flex flex-col gap-6">

        <div class="glass-panel p-6 text-center">
            <h2 class="text-xl font-bold text-white mb-2">Analýza webu</h2>
            <p class="text-slate-400 mb-4 text-xs">Zadajte URL (napr. sme.sk) a počkajte na výsledok.</p>
            
            <div class="flex flex-col sm:flex-row gap-3">
                <input type="text" id="urlInput" placeholder="zadaj-domenu.sk" class="flex-1 bg-slate-900 border border-slate-700 text-white rounded-xl px-4 py-3 focus:border-emerald-500 outline-none text-base">
                <button onclick="analyzeUrl()" id="btnAnalyze" class="btn-gradient text-white font-bold px-6 py-3 rounded-xl flex items-center justify-center gap-2">
                    <i class="fa-solid fa-rocket"></i> Analyzovať
                </button>
            </div>
            <div id="loading" class="hidden mt-4 text-emerald-400 text-sm font-bold animate-pulse">
                <i class="fa-solid fa-circle-notch fa-spin mr-2"></i> Sťahujem dáta zo stránky...
            </div>
            <div id="errorMsg" class="hidden mt-4 p-3 bg-red-500/20 text-red-200 text-xs rounded border border-red-500/30"></div>
        </div>

        <div id="resultsArea" class="hidden grid grid-cols-1 lg:grid-cols-12 gap-6 pb-10">
            
            <div class="lg:col-span-7 space-y-6">
                
                <div class="glass-panel p-5 border-l-4 border-emerald-500">
                    <div class="flex flex-col sm:flex-row items-center gap-6">
                        <div class="text-center">
                            <div class="score-circle" id="scoreCircle" style="--score-color: #10b981; --score-percent: 0%;">
                                <span class="score-val" id="scoreVal">0</span>
                            </div>
                            <div class="text-[10px] text-slate-400 font-bold mt-2 uppercase">SEO Skóre</div>
                        </div>
                        
                        <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 w-full">
                            <div class="bg-slate-800/50 p-2 rounded text-center">
                                <div class="text-lg font-bold text-blue-400" id="statWords">0</div>
                                <div class="text-[10px] text-slate-500 uppercase">Slov</div>
                            </div>
                            <div class="bg-slate-800/50 p-2 rounded text-center">
                                <div class="text-lg font-bold text-purple-400" id="statLinks">0</div>
                                <div class="text-[10px] text-slate-500 uppercase">Odkazov</div>
                            </div>
                            <div class="bg-slate-800/50 p-2 rounded text-center">
                                <div class="text-lg font-bold text-orange-400" id="statImages">0</div>
                                <div class="text-[10px] text-slate-500 uppercase">Obrázkov</div>
                            </div>
                            <div class="bg-slate-800/50 p-2 rounded text-center">
                                <div class="text-lg font-bold text-pink-400" id="statHtags">0</div>
                                <div class="text-[10px] text-slate-500 uppercase">H-Tagov</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass-panel p-5">
                    <h3 class="text-xs font-bold text-slate-400 uppercase mb-4">Technický Audit</h3>
                    <div class="space-y-3" id="auditList"></div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                    <div class="glass-panel p-5">
                        <h3 class="text-xs font-bold text-slate-400 uppercase mb-4">Kľúčové slová</h3>
                        <div class="flex flex-wrap gap-2" id="keywordList"></div>
                    </div>
                    <div class="glass-panel p-5">
                        <h3 class="text-xs font-bold text-slate-400 uppercase mb-4">Sociálne siete</h3>
                        <div id="socialList" class="flex flex-wrap gap-2">
                            <span class="text-slate-500 text-xs italic">Žiadne prepojenia.</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-5 space-y-6">
                
                <div class="glass-panel p-5 bg-gradient-to-br from-slate-800 to-slate-900 border border-slate-700">
                    <h3 class="text-sm font-bold text-white mb-2"><i class="fa-solid fa-user-doctor text-emerald-400 mr-2"></i>Diagnóza</h3>
                    <p class="text-slate-300 text-sm italic leading-relaxed" id="aiVerdict">...</p>
                </div>

                <div class="glass-panel p-4">
                    <h3 class="text-xs font-bold text-slate-400 uppercase mb-3"><i class="fa-brands fa-google text-blue-500"></i> Google</h3>
                    <div class="preview-box g-wrap">
                        <div class="g-link">
                            <img id="gFavicon" src="" class="w-4 h-4 hidden">
                            <span id="gDomain" class="font-bold">domena.sk</span>
                        </div>
                        <a href="#" class="g-title" id="gTitle">Titulok stránky</a>
                        <div class="g-desc" id="gDesc">Popis stránky...</div>
                    </div>
                </div>

                <div class="glass-panel p-4">
                    <h3 class="text-xs font-bold text-slate-400 uppercase mb-3"><i class="fa-brands fa-facebook text-blue-600"></i> Facebook</h3>
                    <div class="fb-wrap">
                        <div class="fb-img-area">
                            <img id="fbImg" class="fb-img hidden">
                            <div id="fbNoImg" class="absolute inset-0 flex items-center justify-center text-gray-400 text-xs">Bez obrázka</div>
                        </div>
                        <div class="fb-text-area">
                            <div class="fb-domain" id="fbDomain">DOMENA.SK</div>
                            <div class="fb-title" id="fbTitle">Titulok</div>
                            <div class="fb-desc" id="fbDesc">Popis...</div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </main>

<script>
    async function analyzeUrl() {
        const input = document.getElementById('urlInput');
        const btn = document.getElementById('btnAnalyze');
        const loading = document.getElementById('loading');
        const err = document.getElementById('errorMsg');
        const results = document.getElementById('resultsArea');
        let url = input.value.trim();

        if (!url) return;

        url = url.replace(/\s/g, ''); 
        if (!/^https?:\/\//i.test(url)) {
            url = 'https://' + url;
        }

        // Reset
        err.classList.add('hidden');
        results.classList.add('hidden');
        loading.classList.remove('hidden');
        btn.disabled = true;
        input.disabled = true;

        try {
            // PROXY Fetch
            const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(url)}`;
            const response = await fetch(proxyUrl);
            if (!response.ok) throw new Error(`Server vrátil chybu: ${response.status}`);
            
            const htmlText = await response.text();
            if (!htmlText || htmlText.length < 50) throw new Error("Stránka vrátila prázdny obsah.");

            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlText, "text/html");

            // Meta Data Extraction
            const meta = {
                title: doc.querySelector('title')?.innerText || "",
                desc: doc.querySelector('meta[name="description"]')?.getAttribute('content') || "",
                h1: doc.querySelector('h1')?.innerText || "",
                h2s: doc.querySelectorAll('h2').length,
                h3s: doc.querySelectorAll('h3').length,
                ogTitle: doc.querySelector('meta[property="og:title"]')?.getAttribute('content') || "",
                ogDesc: doc.querySelector('meta[property="og:description"]')?.getAttribute('content') || "",
                ogImage: doc.querySelector('meta[property="og:image"]')?.getAttribute('content') || "",
                favicon: `https://www.google.com/s2/favicons?domain=${url}&sz=64`,
                domain: new URL(url).hostname,
                images: Array.from(doc.querySelectorAll('img')),
                links: Array.from(doc.querySelectorAll('a')),
                bodyText: doc.body.innerText
            };

            // Image Fix
            if (!meta.ogImage) {
                const firstImg = doc.querySelector('img[src^="http"], img[src^="/"]');
                if (firstImg) meta.ogImage = firstImg.getAttribute('src');
            }
            if (meta.ogImage && !meta.ogImage.startsWith('http')) {
                const origin = new URL(url).origin;
                meta.ogImage = origin + (meta.ogImage.startsWith('/') ? '' : '/') + meta.ogImage;
            }

            // Render
            renderData(meta, url);
            detectSocials(doc); // PRIDANÉ SPÄŤ

            loading.classList.add('hidden');
            results.classList.remove('hidden');
            setTimeout(() => results.scrollIntoView({ behavior: 'smooth', block: 'start' }), 100);

        } catch (e) {
            console.error(e);
            loading.classList.add('hidden');
            err.innerHTML = `<strong>Chyba:</strong> ${e.message}<br>Tip: Niektoré weby blokujú botov.`;
            err.classList.remove('hidden');
        } finally {
            btn.disabled = false;
            input.disabled = false;
        }
    }

    function renderData(meta, url) {
        // Stats
        const words = meta.bodyText.split(/\s+/).filter(w => w.length > 0).length;
        document.getElementById('statWords').innerText = words;
        document.getElementById('statLinks').innerText = meta.links.length;
        document.getElementById('statImages').innerText = meta.images.length;
        document.getElementById('statHtags').innerText = meta.h2s + meta.h3s;

        // Previews
        document.getElementById('gTitle').innerText = truncate(meta.title, 60) || "Bez titulku";
        document.getElementById('gDesc').innerText = truncate(meta.desc, 155) || "Bez popisu...";
        document.getElementById('gDomain').innerText = meta.domain;
        document.getElementById('gFavicon').src = meta.favicon;
        document.getElementById('gFavicon').classList.remove('hidden');

        document.getElementById('fbTitle').innerText = truncate(meta.ogTitle || meta.title, 80);
        document.getElementById('fbDesc').innerText = truncate(meta.ogDesc || meta.desc, 100);
        document.getElementById('fbDomain').innerText = meta.domain.toUpperCase();
        
        const fbImg = document.getElementById('fbImg');
        const fbNoImg = document.getElementById('fbNoImg');
        if (meta.ogImage) {
            fbImg.src = meta.ogImage;
            fbImg.classList.remove('hidden');
            fbNoImg.classList.add('hidden');
        } else {
            fbImg.classList.add('hidden');
            fbNoImg.classList.remove('hidden');
        }

        analyzeKeywords(meta.bodyText);
        calculateAudit(meta, words);
    }

    function calculateAudit(meta, wordCount) {
        const list = document.getElementById('auditList');
        const verdictEl = document.getElementById('aiVerdict');
        const scoreCircle = document.getElementById('scoreCircle');
        const scoreVal = document.getElementById('scoreVal');
        
        list.innerHTML = '';
        let score = 0;
        let total = 0;

        const check = (label, condition, successMsg, failMsg, weight = 1) => {
            total += weight;
            if(condition) score += weight;
            
            const color = condition ? 'dot-green' : 'dot-red';
            const textClass = condition ? 'text-slate-300' : 'text-red-300';
            
            list.innerHTML += `
                <div class="flex justify-between items-center border-b border-slate-700/50 pb-2">
                    <div class="flex items-center gap-2">
                        <span class="status-dot ${color}"></span>
                        <span class="text-white font-medium text-xs">${label}</span>
                    </div>
                    <span class="text-[10px] ${textClass} text-right">${condition ? successMsg : failMsg}</span>
                </div>
            `;
        };

        check("Titulok", meta.title.length > 10 && meta.title.length < 70, "OK ✅", "Zlá dĺžka", 3);
        check("Meta Popis", meta.desc.length > 50 && meta.desc.length < 160, "OK ✅", "Chýba/Zlý", 3);
        check("Nadpis H1", meta.h1.length > 0, "OK ✅", "Chýba", 3);
        check("Obsah", wordCount > 300, "OK ✅", "Málo textu", 2);
        check("Obrázky", meta.images.length > 0, "OK ✅", "Žiadne", 1);
        check("Social", meta.ogImage.length > 0, "OK ✅", "Chýba img", 1);
        check("HTTPS", true, "Aktívne ✅", "Neaktívne", 1);

        const finalScore = Math.round((score / total) * 100);
        
        // Animácia čísla
        let start = 0;
        const duration = 1000;
        const step = (ts) => {
            if (!start) start = ts;
            const progress = Math.min((ts - start) / duration, 1);
            scoreVal.innerText = Math.floor(progress * finalScore);
            if (progress < 1) requestAnimationFrame(step);
        };
        requestAnimationFrame(step);

        let color = '#ef4444';
        if(finalScore > 50) color = '#f59e0b';
        if(finalScore > 80) color = '#10b981';
        scoreCircle.style.setProperty('--score-color', color);
        scoreCircle.style.setProperty('--score-percent', `${finalScore}%`);

        if(finalScore > 80) verdictEl.innerText = "Výborný stav! Web je technicky pripravený.";
        else if(finalScore > 50) verdictEl.innerText = "Priemerný stav. Skontrolujte meta tagy.";
        else verdictEl.innerText = "Slabý stav. Chýbajú základné SEO prvky.";
    }

    function analyzeKeywords(text) {
        if (!text) return;
        const words = text.toLowerCase().replace(/[^\w\s\u00C0-\u017F]/g, '').split(/\s+/);
        const stopWords = ['a', 'v', 's', 'z', 'o', 'u', 'k', 'na', 'pre', 'pri', 'do', 'je', 'sa', 'si', 'to', 'že', 'ako', 'čo', 'len', 'ale', 'kde', 'kto', 'bol', 'bude', 'sme', 'sú'];
        
        const counts = {};
        words.forEach(w => {
            if(w.length > 3 && !stopWords.includes(w) && isNaN(w)) counts[w] = (counts[w] || 0) + 1;
        });

        const sorted = Object.entries(counts).sort((a,b) => b[1] - a[1]).slice(0, 8);
        const container = document.getElementById('keywordList');
        container.innerHTML = '';
        
        if(sorted.length === 0) container.innerHTML = '<span class="text-slate-500 text-xs">Žiadne dáta</span>';

        sorted.forEach(([word, count]) => {
            container.innerHTML += `<span class="bg-white/10 px-2 py-1 rounded-full text-[10px] text-slate-300 border border-white/5">${word} <span class="opacity-50 ml-1">${count}x</span></span>`;
        });
    }

    function detectSocials(doc) {
        const socialMap = {
            'facebook.com': { name: 'Facebook', cls: 'soc-fb', icon: 'fa-facebook' },
            'instagram.com': { name: 'Instagram', cls: 'soc-ig', icon: 'fa-instagram' },
            'linkedin.com': { name: 'LinkedIn', cls: 'soc-li', icon: 'fa-linkedin' },
            'tiktok.com': { name: 'TikTok', cls: 'soc-tt', icon: 'fa-tiktok' },
            'youtube.com': { name: 'YouTube', cls: 'soc-yt', icon: 'fa-youtube' }
        };

        const links = Array.from(doc.querySelectorAll('a'));
        const found = new Set();
        const container = document.getElementById('socialList');
        container.innerHTML = '';

        links.forEach(link => {
            const href = link.href.toLowerCase();
            for (const [domain, info] of Object.entries(socialMap)) {
                if (href.includes(domain)) found.add(info);
            }
        });

        if (found.size === 0) {
            container.innerHTML = '<span class="text-slate-500 text-xs italic">Žiadne prepojenia.</span>';
        } else {
            found.forEach(soc => {
                container.innerHTML += `<span class="social-tag ${soc.cls}"><i class="fa-brands ${soc.icon}"></i> ${soc.name}</span>`;
            });
        }
    }

    function truncate(str, n) { return (str.length > n) ? str.substr(0, n-1) + '...' : str; }
</script>

</body>
</html>
