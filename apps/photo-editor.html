<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Photo Editor (Crop & Rotate) | Unoneto</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: white; -webkit-tap-highlight-color: transparent; }
        
        .glass-panel {
            background: rgba(30, 41, 59, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            overflow: hidden;
        }

        .upload-box {
            border: 2px dashed #475569; border-radius: 16px; padding: 40px 20px;
            text-align: center; cursor: pointer; transition: 0.2s; background: rgba(15, 23, 42, 0.5);
            min-height: 300px; display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .upload-box:hover { border-color: #818cf8; background: rgba(129, 140, 248, 0.05); }

        /* Toolbar Buttony */
        .tool-btn {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            color: #cbd5e1; width: 44px; height: 44px; border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s; cursor: pointer;
        }
        .tool-btn:hover, .tool-btn.active { background: #4f46e5; color: white; border-color: #4f46e5; }
        
        .ratio-btn {
            padding: 6px 12px; font-size: 0.85rem; border-radius: 8px;
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #cbd5e1;
            transition: 0.2s; white-space: nowrap;
        }
        .ratio-btn:hover, .ratio-btn.active { background: #4f46e5; color: white; border-color: #4f46e5; }

        /* Cropper kontajner */
        .editor-container {
            height: 60vh; /* Pevn√° v√Ω≈°ka pre editor */
            width: 100%;
            background: #000;
            display: none; /* Skryt√© k√Ωm nie je fotka */
            border-radius: 12px;
            overflow: hidden;
        }
        
        /* Cropper.js override */
        .cropper-view-box, .cropper-face { border-radius: 0; }
        .cropper-point { background-color: #4f46e5; }
        .cropper-line { background-color: #4f46e5; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4">

    <div class="w-full max-w-5xl flex items-center justify-between mb-4 pt-2">
        <a href="index.html" class="flex items-center gap-2 text-slate-400 hover:text-white px-2 py-1 rounded-lg">
            <span>‚Üê</span> Sp√§≈•
        </a>
        <h1 class="font-bold text-lg text-white flex items-center gap-2">
            <i class="fa-solid fa-crop-simple text-indigo-400"></i> Photo Editor
        </h1>
    </div>

    <div class="w-full max-w-5xl glass-panel flex flex-col md:flex-row h-full md:h-[85vh] overflow-hidden">
        
        <div class="flex-1 bg-slate-900/50 p-4 flex items-center justify-center relative flex-col">
            
            <label id="upload-state" class="upload-box w-full max-w-lg">
                <input type="file" id="imageInput" class="hidden" accept="image/*">
                <div class="text-5xl mb-4 text-slate-600">üñºÔ∏è</div>
                <h3 class="text-xl font-bold text-white mb-2">Nahra≈• fotku</h3>
                <p class="text-slate-400 text-sm">JPG, PNG alebo WebP</p>
            </label>

            <div id="editor-wrapper" class="editor-container">
                <img id="image-target" src="" alt="Editor" style="max-width: 100%;">
            </div>

            <div id="loader" class="hidden absolute inset-0 bg-slate-900/80 flex items-center justify-center z-50">
                <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"></div>
            </div>
        </div>

        <div id="sidebar" class="w-full md:w-80 bg-slate-800/50 border-t md:border-t-0 md:border-l border-slate-700 p-5 flex flex-col gap-6 opacity-50 pointer-events-none transition-opacity">
            
            <div>
                <label class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3 block">Rot√°cia & Zoom</label>
                <div class="flex gap-2 mb-3">
                    <button class="tool-btn" onclick="rotate(-90)" title="Doƒæava"><i class="fa-solid fa-rotate-left"></i></button>
                    <button class="tool-btn" onclick="rotate(90)" title="Doprava"><i class="fa-solid fa-rotate-right"></i></button>
                    <button class="tool-btn" onclick="flip('h')" title="Zrkadli≈•"><i class="fa-solid fa-right-left"></i></button>
                    <button class="tool-btn" onclick="zoom(0.1)" title="Pribl√≠≈æi≈•"><i class="fa-solid fa-magnifying-glass-plus"></i></button>
                    <button class="tool-btn" onclick="zoom(-0.1)" title="Oddiali≈•"><i class="fa-solid fa-magnifying-glass-minus"></i></button>
                </div>
            </div>

            <div>
                <label class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3 block">Pomer str√°n</label>
                <div class="grid grid-cols-3 gap-2">
                    <button class="ratio-btn active" onclick="setRatio(NaN, this)">Voƒæn√Ω</button>
                    <button class="ratio-btn" onclick="setRatio(1, this)">1:1</button>
                    <button class="ratio-btn" onclick="setRatio(16/9, this)">16:9</button>
                    <button class="ratio-btn" onclick="setRatio(4/3, this)">4:3</button>
                    <button class="ratio-btn text-indigo-300 border-indigo-500/30" onclick="setRatio(3/4, this)">3:4 (Doklad)</button>
                    <button class="ratio-btn" onclick="setRatio(2/3, this)">2:3</button>
                </div>
            </div>

            <div class="flex-1"></div> <div class="flex flex-col gap-3">
                <button onclick="downloadImage()" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 rounded-xl shadow-lg shadow-indigo-500/20 transition transform active:scale-95 flex items-center justify-center gap-2">
                    <i class="fa-solid fa-download"></i> Ulo≈æi≈• obr√°zok
                </button>
                <button onclick="resetEditor()" class="w-full bg-slate-700 hover:bg-slate-600 text-slate-300 font-medium py-3 rounded-xl transition">
                    Nahra≈• nov√∫
                </button>
            </div>
        </div>
    </div>

<script>
    // --- VARIABLES ---
    const imageInput = document.getElementById('imageInput');
    const imageTarget = document.getElementById('image-target');
    const uploadState = document.getElementById('upload-state');
    const editorWrapper = document.getElementById('editor-wrapper');
    const sidebar = document.getElementById('sidebar');
    const loader = document.getElementById('loader');
    
    let cropper = null;
    let scaleX = 1; // Pre zrkadlenie

    // --- UPLOAD LOGIC ---
    imageInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            startEditor(file);
        }
    });

    function startEditor(file) {
        loader.classList.remove('hidden');
        
        const reader = new FileReader();
        reader.onload = (e) => {
            imageTarget.src = e.target.result;
            
            // UI Switch
            uploadState.style.display = 'none';
            editorWrapper.style.display = 'block';
            sidebar.classList.remove('opacity-50', 'pointer-events-none');
            
            // Init Cropper
            if(cropper) cropper.destroy();
            
            imageTarget.onload = () => {
                cropper = new Cropper(imageTarget, {
                    viewMode: 1, // Obmedzi≈• v√Ωrez na veƒækos≈• pl√°tna
                    dragMode: 'move',
                    aspectRatio: NaN, // Default Free
                    autoCropArea: 0.9,
                    restore: false,
                    guides: true,
                    center: true,
                    highlight: false,
                    cropBoxMovable: true,
                    cropBoxResizable: true,
                    toggleDragModeOnDblclick: false,
                    ready() {
                        loader.classList.add('hidden');
                    }
                });
            };
        };
        reader.readAsDataURL(file);
    }

    // --- TOOLS LOGIC ---
    function rotate(deg) {
        if(cropper) cropper.rotate(deg);
    }

    function zoom(ratio) {
        if(cropper) cropper.zoom(ratio);
    }

    function flip(dir) {
        if(!cropper) return;
        if(dir === 'h') {
            scaleX = -scaleX;
            cropper.scaleX(scaleX);
        }
    }

    function setRatio(ratio, btn) {
        if(!cropper) return;
        cropper.setAspectRatio(ratio);
        
        // UI Update
        document.querySelectorAll('.ratio-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    // --- DOWNLOAD LOGIC ---
    function downloadImage() {
        if(!cropper) return;
        
        loader.classList.remove('hidden');
        
        // Z√≠skame canvas v plnej kvalite
        const canvas = cropper.getCroppedCanvas({
            maxWidth: 4096,
            maxHeight: 4096,
            fillColor: '#fff', // Ak by vznikli priehƒæadn√© miesta (napr. pri JPG)
            imageSmoothingEnabled: true,
            imageSmoothingQuality: 'high',
        });

        canvas.toBlob((blob) => {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'upravena-fotka.jpg';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            loader.classList.add('hidden');
        }, 'image/jpeg', 0.95); // 95% kvalita JPG
    }

    function resetEditor() {
        if(cropper) cropper.destroy();
        cropper = null;
        imageInput.value = '';
        uploadState.style.display = 'flex';
        editorWrapper.style.display = 'none';
        sidebar.classList.add('opacity-50', 'pointer-events-none');
    }
</script>
</body>
</html>